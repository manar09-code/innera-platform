<div class="feed-wrapper">
  <!-- User Profile Header -->
  <div class="user-header">
    <div class="user-profile">
      <div class="user-avatar">{{ userName.charAt(0).toUpperCase() }}</div>
      <div class="user-info">
        <h2 class="user-name">{{ userName || 'Guest' }}</h2>
        <p class="user-status">
          <span>{{ userRole || 'User' }}</span> ‚Ä¢ <span>{{ communityName }}</span>
        </p>
      </div>
      <button class="btn-back" (click)="goBack()">Logout</button>
    </div>
    <app-navbar></app-navbar>
  </div>

  <!-- Main Feed Content -->
  <div class="feed-content">
    <div class="feed-grid">
      <!-- Center Column: Main Feed -->
      <div class="feed-center-column">
        <!-- Welcome Card -->
        <div class="welcome-card">
          <div class="welcome-image">
            <div class="mountain-placeholder"></div>
            <div class="welcome-overlay">
              <h1 class="welcome-title">Welcome to {{ communityName }} Community</h1>
              <p class="welcome-subtitle">Share your thoughts and connect with the community</p>
            </div>
          </div>
        </div>

        <!-- Create Post Card -->
        <div class="create-post-card">
          <div class="create-post-header">
            <h2 class="section-title">Create a Post</h2>
          </div>

          <!-- Post Tabs -->
          <div class="post-tabs">
            <button
              class="tab-btn"
              [class.active]="currentTab === 'post'"
              (click)="switchTabUI('post')"
            >
              <span class="tab-icon">üìù</span>
              Text Post
            </button>
            <button
              class="tab-btn"
              [class.active]="currentTab === 'image'"
              (click)="switchTabUI('image')"
            >
              <span class="tab-icon">üñºÔ∏è</span>
              Image Post
            </button>
          </div>

          <!-- Post Input -->
          <div class="post-input-container">
            <textarea
              class="post-textarea"
              placeholder="What's on your mind?"
              rows="4"
              [(ngModel)]="postText"
              (input)="onPostInput()"
            ></textarea>
          </div>

          <!-- Post Button -->
          <button class="post-button" (click)="handlePostSubmit()">
            {{ currentTab === 'post' ? 'Post' : 'Upload Image' }}
          </button>
        </div>

        <!-- Posts Feed -->
        <div class="posts-feed">
          <div class="post-card" *ngFor="let post of posts; trackBy: trackByPostId">
            <!-- Post Header -->
            <div class="post-header">
              <div class="post-avatar" (click)="navigateToProfile()">{{ post.avatar }}</div>
              <div class="post-meta" (click)="navigateToProfile()">
                <h3 class="post-author">{{ post.author }}</h3>
                <p class="post-time">{{ post.time }}</p>
              </div>
              <button class="post-options" *ngIf="isAdmin" (click)="deletePost(post)">√ó</button>
            </div>

            <!-- Post Content -->
            <p class="post-content">{{ post.content }}</p>

            <!-- Post Tags -->
            <div class="post-tags">
              <span class="post-tag" *ngFor="let tag of post.tags" (click)="onHashtagClick(tag)">
                {{ tag }}
              </span>
            </div>

            <!-- Post Footer -->
            <div class="post-footer">
              <button class="post-action" (click)="onLikePost(post)">
                <span class="action-icon">{{ post.likedBy.includes(userName) ? '‚ù§Ô∏è' : 'ü§ç' }}</span>
                <span class="action-count">{{ post.likes }}</span>
              </button>
              <button class="post-action" (click)="onCommentPost(post)">
                <span class="action-icon">üí¨</span>
                <span class="action-count">{{ post.comments.length }}</span>
              </button>
            </div>

            <!-- Comments Section -->
            <div class="comments-section" *ngIf="post.comments.length > 0">
              <div class="comment" *ngFor="let comment of post.comments">
                <div class="comment-header">
                  <strong>{{ comment.username }}</strong>
                  <span class="comment-time">{{ comment.time }}</span>
                </div>
                <p class="comment-text">{{ comment.text }}</p>
              </div>
            </div>

            <!-- Add Comment -->
            <div class="add-comment">
              <textarea
                class="comment-input"
                placeholder="Write a comment..."
                [(ngModel)]="newCommentText[post.id]"
                rows="2"
              ></textarea>
              <button
                class="comment-submit-btn"
                (click)="submitComment(post)"
                [disabled]="!newCommentText[post.id]?.trim()"
              >
                Comment
              </button>
            </div>
          </div>
        </div>

        <!-- Floating AI Assistant Circle -->
        <div class="floating-ai-assistant" (click)="navigateToAiAssistant()">ü§ñ</div>
      </div>

      <!-- Right Column: Trends -->
      <div class="trends-column">
        <!-- Trending Tags -->
        <div class="trending-section">
          <h3 class="section-title">Trending</h3>
          <div class="hashtags-container">
            <button
              class="hashtag-btn"
              *ngFor="let tag of trendingTags"
              (click)="onHashtagClick(tag)"
            >
              {{ tag }}
            </button>
          </div>
        </div>

        <!-- Popular Posts -->
        <div class="popular-posts">
          <h3 class="section-title">Popular Posts</h3>
          <div class="popular-post" *ngFor="let post of popularPosts">
            <p class="popular-post-content">{{ post.content.substring(0, 100) }}...</p>
            <p class="popular-post-likes">{{ post.likes }} likes</p>
          </div>
        </div>

        <!-- Active Members -->
        <div class="active-members">
          <h3 class="section-title">Active Members</h3>
          <div class="active-member" *ngFor="let member of activeMembers">
            <div class="member-avatar">{{ member.avatar }}</div>
            <div class="member-info">
              <h4 class="member-name">{{ member.name }}</h4>
              <p class="member-activity">{{ member.activity }} posts</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
