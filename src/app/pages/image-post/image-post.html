<div class="image-post-wrapper">
  <div class="image-post-header">
    <button class="btn-back" (click)="goBack()">Back</button>
    <h1 class="page-title">Image Post</h1>
  </div>

  <div class="image-post-container">

    <!-- Main Section -->
    <div class="main-section">
      <h3>Main Section</h3>
      <div class="upload-options">
        <input type="file" #fileInput hidden accept="image/*" (change)="onFileSelected($event)" />
        <button type="button" (click)="fileInput.click()">Upload Image</button>
        <button type="button" (click)="takePhoto()">Take Photo</button>
      </div>
      @if (imagePreview) {
        <div class="image-preview">
          <img [src]="imagePreview" alt="Preview" />
        </div>
      }
      <textarea [(ngModel)]="caption" placeholder="Add a caption..." rows="3"></textarea>
    </div>

    <!-- Action Section -->
    <div class="action-section">
      <h3>Actions</h3>
      <!-- Display upload status message -->
      @if (isUploading) {
        <p style="color: #3b82f6; font-size: 13px; margin-bottom: 10px;">
          <b>Uploading image to cloud storage...</b>
        </p>
      }
      @if (!isEditing) {
        <button (click)="createPost()" [disabled]="!imagePreview || !caption.trim() || isUploading">
          {{ isUploading ? 'Processing...' : 'Create Image Post' }}
        </button>
      }
      @if (isEditing) {
        <button (click)="updatePost()" [disabled]="!imagePreview || !caption.trim()">
          Update Image Post
        </button>
      }
      @if (isEditing) {
        <button (click)="deletePost()">Delete Image Post</button>
      }
      @if (isEditing) {
        <button (click)="resetForm()">Cancel</button>
      }
    </div>

    <!-- History Section -->
    <div class="history-section">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3 style="margin: 0;">History</h3>
        <button (click)="loadPosts()"
          style="padding: 6px 12px; font-size: 12px; background: #64748b; color: white; border: none; border-radius: 4px; cursor: pointer;">
          Refresh History
        </button>
      </div>
      <div class="post-list">
        @for (post of posts; track post) {
          <div class="post-item" (click)="selectPost(post)">
            <img [src]="post.imageData" alt="Post image" />
            <div>
              <p>{{ post.caption }}</p>
              <small>{{ post.createdAt | date : 'short' }}</small>
            </div>
          </div>
        }
      </div>
    </div>

  </div>
</div>